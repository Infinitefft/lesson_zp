# AI 全栈项目

## 技能点
### react 开发全家桶
- react + typescript(JS超级)
- react-router-dom(前端路由)
- zustand (中央状态管理)
- axios (http请求库) 

### 后端
- node + ts 
- nestjs 企业级别后端开发框架 
- psql 数据库
- redis 缓存数据库
### AI 
- langchain 
- coze/n8n 
- llm 
- trae/cursor 
## 项目安排
- frontend
- backend
- ai_server
- admin 后台管理系统

## git 操作 
- 全新的实战项目 
  git init 
- 提交的时机
  每次完成一个相对独立的模块后，提交一下
  提交信息要准确完整

## react 全家桶
### react-router-dom 
- 前端路由 
早期前端没有路由，路由由后端，前端是切图崽
前后端分离， 前端有独立的（html5）路由，实现页面切换。
- 两种形式
  - HashRouter  #/ 丑一点 很温柔 兼容性很好 瞄点  
  - BrowserRouter / 和后端路由一样，需要使用到html5 history API 
  兼容不好，ie11 之前不兼容， 现在的浏览器几乎都支持 
- as Router 可读性 
- 性能， 快 页面组件的懒加载
  /   Home  延迟一下About  阻止加载
  /About About 

### 路由有多少种？
- 普通路由 
- 动态路由 /product/:id
- 通配路由 * 
- 嵌套路由 Outlet 
  <Outlet> 是 React Router DOM 中的组件，用于在父路由元素中渲染其子路由匹配到的内容。
- 鉴权路由（路由守卫） ProtectRoute
- redirect 重定向路由 Navigate
### 路由生成访问历史
  history 栈 先进后出
  replace redirect 跳转，会替换当前的历史记录
### 单页应用
- 传统的开发是多页的，基于http 请求，每次url 发生改变后，去服务器重新请求整个页面。
  体验不好，页面会白一下
- 单页应用 react-router-dom html5 history 
  前端路由
  路由改变后，前端会收到一个事件， 讲匹配的新路由显示在页面上

## typescript 
JavaScript 超级 ， 强类型静态语言
- 安装 ts 
  npm install -g typescript
- ts 的优点
  - 静态类型
  - 边写边检查bug
  - 编译时检查类型错误
  - 代码建议、文档查看都非常方便
  - 没有使用变量等垃圾代码提示未使用(console.log)
    重构、修改别人的代码
    干净的代码

### TypeScript 实战 todos

### zustand 状态管理
如果说国家需要有中央银行，那么前端项目就需要中央状态管理系统。zustand \ redux
- 组件 = UI + State
- store 将状态存到store仓库中
  全局共享
- 基于hooks思想实现的

## 数据库设计
- 关系型数据库 mysql/postgresql
是一种以二维表格（行/列） 组织存储数据，通过主键（Primary key）
外键建立表格间逻辑关联，遵循ACID 事务特性保证数据一致性和可靠性的数据库。
表 Table users 类
row 实例
column 属性
### 主键
- 词典
  索引目录
- 唯一的，自增的
- 高效 利用索引
### 唯一索引 uniq
  - username  唯一性、正确性
### 外键 约束 foreign key
  - posts 文章id， userId
  - id 引用 users 表的主键
  posts.userId == user.id 关联
### 普通外键 key
  - 不能乱建
  - 查询的频繁度

### 文章系统
- 文章表 posts
- 用户表 users
- 评论表 comments
- 点赞表 likes
- 标签表 tags
- 收藏表 favorites

### 连接
- 左连接 left join
  - 左表所有数据，右表匹配的数据
- 右连接 right join
  - 右表所有数据，左表匹配的数据
- 内连接 inner join
  - 左右表都匹配的数据
- 全连接 full join
  - 左右表所有数据

### ACID
- 事务
A Atomicity 原子性
要么都成功过，要么全部失败回滚。
转账 扣 A 的100元，和增加 B 的100元，转账事务
- A 成功 type = out 减少总金额 先 成功，回滚失败
- B 成功 type = in 增加总金额 后 失败

C Consistency 一致性
数据库从一个一致状态转换到另一个一致状态，
转账事务中，A 和 B 的总金额保持不变。

I Isolation 隔离性
并发执行的事务 相互独立，互不干扰
两笔转账， A 转 B 100元， C 转 B 200元

D Durability 持久性
事务一旦提交，对数据库的改变是永久的，不会因为系统故障而丢失


### psql
#### 基本操作
- \list 列出所有数据库
- 创建数据库
CREATE DATABASE xuebi WITH OWNER=postgres ENCODING 'UTF-8';
- 进入数据库
\c xuebi
### prompt 建表

```
你是一位psql高级工程师，需要设计一个users表，
包含id, name, password 三个字段。id 自增，主键；name 不能重复；
请给出建表sql


CREATE TABLE users (
    -- 使用 BIGINT 避免未来数据量过大导致 ID 溢出，IDENTITY 是 SQL 标准自增方式
    -- INT（上限21亿) BIGINT（8字节）
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    
    -- UNIQUE 约束会自动创建索引，NOT NULL 保证数据完整性
    name VARCHAR(255) NOT NULL UNIQUE,
    
    -- 密码字段，通常长度设为 255 以适配各种哈希加密算法（如 bcrypt）
    password VARCHAR(255) NOT NULL,
    
    -- 高级工程师通常会增加这两个审计字段
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);
```

### seeds 初始化数据
```
INSERT INTO "users" ("id", "name", "password") VALUES
('1', '王皓', '$2b$10$CsO/ykedPpuxqUETBZTYm.F2U4TXDdo01rLmoRPwjKBv3pIL5pnWq'),
('2', '小雪', '$2b$10$CsO/ykedPpuxqUETBZTYm.F2U4TXDdo01rLmoRPwjKBv3pIL5pnWq'),
('3', '李白', '$2b$10$CsO/ykedPpuxqUETBZTYm.F2U4TXDdo01rLmoRPwjKBv3pIL5pnWq'),
('4', '杜甫', '$2b$10$CsO/ykedPpuxqUETBZTYm.F2U4TXDdo01rLmoRPwjKBv3pIL5pnWq'),
('5', '白居易', '$2b$10$CsO/ykedPpuxqUETBZTYm.F2U4TXDdo01rLmoRPwjKBv3pIL5pnWq'),
('6', '张三', '$2b$10$CsO/ykedPpuxqUETBZTYm.F2U4TXDdo01rLmoRPwjKBv3pIL5pnWq');
```

你是一位psql 高级工程师， 需要建一个posts 表， 包含id, title, content,userId 三个字段。id 自增， 主键， title 不为空，不超过255个字符， content  长文本，  usersId 是bigint 类型，是 users 表的外键，请给出建表sql

```
CREATE TABLE posts (
     id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    content TEXT,
    "userId" BigInt NOT NULL,
     -- 高级工程师通常会增加这两个审计字段
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT fk_posts_user FOREIGN KEY ("userId") REFERENCES users(id) ON DELETE CASCADE
);
```

```
INSERT INTO "posts" ("title", "content", "userId") VALUES 
('黄鹤楼送孟浩然之广陵', '故人西辞黄鹤楼，烟花三月下扬州', 3),
('春夜喜雨', '好雨知时节，当春乃发生', 4),
('琵琶行', '浔阳江头夜送客，枫叶荻花秋瑟瑟', 5),
('静夜思', '床前明月光，疑是地上霜', 3),
('望岳', '会当凌绝顶，一览众山小', 4),
('浪淘沙', '白浪茫茫与海连，平沙浩浩四无边', 5),
('将进酒', '君不见黄河之水天上来，奔流到海不复回', 3),
('天末怀李白', '凉风起天末，君子意如何', 4),
('花非花', '花非花，雾非雾，夜半来，天明去', 5),
('望庐山瀑布', '日照香炉生紫烟，遥看瀑布挂前川', 3),
('绝句二首', '迟日江山丽，春风花草香', 4),
('秋思', '夕照红于烧，晴空碧胜蓝', 5),
('早发白帝城', '朝辞白帝彩云间，千里江陵一日还', 3),
('龙门镇', '细泉兼轻冰，沮洳栈道湿', 4),
('采莲曲', '菱叶萦波荷飐风，荷花深处小船通', 5),
('独坐敬亭山', '众鸟高飞尽，孤云独去闲', 3),
('三绝句', '楸树馨香倚钓矶，斩新花蕊未应飞', 4),
('江南春', '青门柳枝软无力，东风吹作黄金色', 5),
('白云泉', '天平山上白云泉，云自无心水自闲', 5),
('叶子的肖像', '叶子的肖像，每张都不一样', 1),
('月下独酌', '花间一壶酒，独酌无相亲', 3),
('登楼', '花近高楼伤客心，万方多难此登临', 4),
('大明湖的荷花', '大明湖里没青蛙，大明湖里有荷花', 1),
('关山月', '明月出天山，苍茫云海间', 3);
```

## nestjs
### express 极简框架
nestjs 企业级开发，基于 TypeScript ，采用模块化架构和依赖注入，
旨在构建高效、可扩展且易于维护的企业级后端应用

- npm i -g @nestjs/cli
- 新建项目 nest new nest-test-demo

### nestjs 理解
- 工厂模式
- main.ts 入口文件
- Module
  app.module.ts

### http 请求动作
语义化 restful 一切皆资源
Method + url 定义方式
- GET/POST
- PUT 上传（更新）头像
- PATCH 局部更新 nickname password...
- DELETE 删除用户


## notes AI 全栈项目
- 登录功能
- 文章系统
- AIGC 功能
- nestjs 后端
### shadcn
- 页面由组件构成，选用第三方组件库
- 严格按需加载
- 组件下载到本地，可以随意地修改。
- 基于tailwindcss
- 配置alias 设置路径别名，更短，好用

### vite 的配置
- vite.config.ts 配置对象
- plugins 插件
  react | vue
  tailwindcss
- resolve
  alias 路径别名
  @ -> __dirname/src
  npm i -D @types/node  node 来到ts 开发的时候
  单独安装了 node 的类型声明文件
- ts 配置文件
  根目录下的 tsconfig.app.json
  compilerOptions 目录输出建议
  baseUrl
  paths

npx shadcn@latest init

npx 是 Node.js 自带的工具，用于临时安装并**执行** npm 包中的命令，无需全局或本地预先安装。
不用预先安装， 试用，测试  用完会删除。
- shadcn 提供命令行
  - button
  npx shadcn@latest add button

### 路由
- 路由懒加载（性能优化的关键）
- suspense + lazy 实现路由懒加载
- 自定义loading 组件
- 路由守卫
  - user store isLogin

### BackToTop 组件
- 通用组件
- 自由状态 isVisible
- onScroll 判断一个阈值，超过阈值显示按钮
- scroll 事件频发触发，性能优化
  - 节流 utils目录下 是一个工具函数
- 组件卸载时 移出事件监听 防止内存泄露。

### 幻灯片组件 slides
- shadcn 提供了 Carousel、CarouselContent、CarouselItem
  一组组件，层次结构
- 自动播放的功能作为插件引入，shadcn 简单性能好，定制性更好
  useRef  持久化的可变对象
  plugins=[]
- api 向外暴露 Carsoul 的各种功能
  selectedIndex 私有状态
  api onSelect 方法 改变
- 指示点
  循环输出
  动态类名
- css
  - transition-all
  - gradient 线性渐变，取代图片做背景
  性能优化 图片做背景 http下载的开销，减少http并发数